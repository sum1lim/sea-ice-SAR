#!/usr/bin/env python3
import argparse
import sys
import csv
from sea_ice_SAR.data_processing import create_dataset


def main(args):
    if args.features == None or args.expert == None:
        print("ERROR: Input file not provided", file=sys.stderr)

    lat_idx = args.lat - 1
    lon_idx = args.lon - 1
    label_idx = args.label - 1

    with open(args.expert) as expert_csv:
        csv_reader = csv.reader(expert_csv)
        expert_data = [
            (row[lat_idx], row[lon_idx], row[label_idx])
            for idx, row in enumerate(csv_reader)
            if idx > 0
        ]
        organized_data, fature_li = create_dataset(expert_data, args.features)

    print(f"\nNumber of samples: {len(organized_data)}", file=sys.stdout)
    with open(".".join(args.expert.split(".")[:-1]) + "_ds.csv", "w") as ds_csv:
        writer = csv.writer(ds_csv)
        writer.writerow(fature_li)
        for k in organized_data.keys():
            writer.writerow(organized_data[k])


if __name__ == "__main__":
    parser = argparse.ArgumentParser()

    parser.add_argument(
        "--features",
        type=str,
        help="Directory path containing SAR data tif images",
    )
    parser.add_argument(
        "--expert",
        type=str,
        help="CSV file with expert data",
    )
    parser.add_argument(
        "--lat",
        type=int,
        help="column no. for latitude attribute (start from 1)",
    )
    parser.add_argument(
        "--lon",
        type=int,
        help="column no. for longitude attribute (start from 1)",
    )
    parser.add_argument(
        "--label",
        type=int,
        help="column no. for label attribute (start from 1)",
    )

    args = parser.parse_args()
    main(args)
